# Price Sniffer — парсер цен из поисковой выдачи (Chrome Extension, MV3)

Расширение для Google Chrome, которое парсит цены с первой страницы поисковой выдачи (Google, Yandex, Bing, DuckDuckGo) по списку товаров из файлов XLSX/CSV и сохраняет результат обратно в файл (XLSX/CSV).

- Поддержка Manifest V3 (service worker)
- Чтение/запись XLSX и CSV на клиенте через SheetJS (без бэкенда)
- Очередь запросов с настраиваемой задержкой
- Автовыбор колонки с наименованием (приоритет «Наименование»)
- Очистка заголовков колонок от переносов/служебных символов
- Колонки результатов добавляются справа: Min, Max, Avg, Currency
- Сохранение состояния и результатов при закрытии попапа (chrome.storage.local)

## Структура
- `manifest.json` — манифест MV3
- `background.js` — service worker: очередь, вкладки, обмен сообщениями
- `content_scripts/extract.js` — извлечение цен на страницах результатов
- `popup.html` / `popup.css` / `popup.js` — UI, чтение XLSX/CSV, интеграция с фоном
- `icons/` — иконки расширения (16/48/128)

## Установка (режим разработчика)
1. Склонируйте репозиторий.
2. Откройте `chrome://extensions/` → включите «Режим разработчика».
3. Нажмите «Загрузить распакованное расширение» и выберите папку проекта.
4. В попапе:
   - Выберите файл XLSX/CSV
   - Укажите колонку с наименованием (или «Авто»)
   - Настройте задержку/лимит и запустите парсинг

## Формат исходного файла
- Первая строка — заголовки колонок
- Колонка «Наименование» — текст запросов/товаров
- Допустимые форматы: XLSX, XLS, CSV

## Результат
В правую часть таблицы добавляются 4 колонки: `Min_*`, `Max_*`, `Avg_*`, `Currency_*`. Индекс (`_*`) подбирается автоматически, чтобы не конфликтовать с уже существующими колонками.

## CSP и безопасность
- Inline-скрипты/стили не используются (всё вынесено в `popup.js` и `popup.css`).
- Разрешения: `storage`, `downloads`, `tabs`, `scripting`, `activeTab`. Хост-доступ только к поисковикам.

## Быстрая проверка синтаксиса JS
```powershell
node -e "const fs=require('fs');['background.js','popup.js','content_scripts/extract.js'].forEach(f=>{const s=fs.readFileSync(f,'utf8');new Function(s);console.log(f+': OK')})"
```

## Лицензия
MIT

Репозиторий: https://github.com/it-tirador/PriceSniffer.git
