# Price Sniffer — парсер цен из поисковой выдачи (Chrome Extension, MV3)

Расширение для Google Chrome, которое парсит цены с первой страницы поисковой выдачи (Google, Yandex, Bing, DuckDuckGo) по списку товаров из файлов XLSX/CSV и сохраняет результат обратно в файл (XLSX/CSV).

- Поддержка Manifest V3 (service worker)
- Чтение/запись XLSX и CSV на клиенте через SheetJS (без бэкенда)
- Очередь запросов с настраиваемой задержкой
- Автовыбор колонки с наименованием (приоритет «Наименование»)
- Очистка заголовков колонок от переносов/служебных символов
- Колонки результатов добавляются справа: Min, Max, Avg, Currency
- Сохранение состояния и результатов при закрытии попапа (chrome.storage.local)

## Структура
- `manifest.json` — манифест MV3
- `background.js` — service worker: очередь, вкладки, обмен сообщениями
- `content_scripts/extract.js` — извлечение цен на страницах результатов
- `popup.html` / `popup.css` / `popup.js` — UI, чтение XLSX/CSV, интеграция с фоном
- `icons/` — иконки расширения (16/48/128)

## Установка (режим разработчика)
1. Склонируйте репозиторий.
2. Откройте `chrome://extensions/` → включите «Режим разработчика».
3. Нажмите «Загрузить распакованное расширение» и выберите папку проекта.
4. В попапе:
   - Выберите файл XLSX/CSV
   - Укажите колонку с наименованием (или «Авто»)
   - Настройте задержку/лимит и запустите парсинг

## Формат исходного файла
- Первая строка — заголовки колонок
- Колонка «Наименование» — текст запросов/товаров
- Допустимые форматы: XLSX, XLS, CSV

## Результат
В правую часть таблицы добавляются 4 колонки: `Min_*`, `Max_*`, `Avg_*`, `Currency_*`. Индекс (`_*`) подбирается автоматически, чтобы не конфликтовать с уже существующими колонками.

## CSP и безопасность
- Inline-скрипты/стили не используются (всё вынесено в `popup.js` и `popup.css`).
- Разрешения: `storage`, `downloads`, `tabs`, `scripting`, `activeTab`. Хост-доступ только к поисковикам.

## Быстрая проверка синтаксиса JS
```powershell
node -e "const fs=require('fs');['background.js','popup.js','content_scripts/extract.js'].forEach(f=>{const s=fs.readFileSync(f,'utf8');new Function(s);console.log(f+': OK')})"
```

## Лицензия
MIT

Репозиторий: https://github.com/it-tirador/PriceSniffer.git

---

## Простая установка из архива (для обычного пользователя)

Ниже инструкция для Chrome и других браузеров на Chromium (Яндекс.Браузер, Edge, Opera).

1) Распаковать архив
- Скачайте архив проекта и распакуйте его в удобную папку, например `C:\PriceSniffer`.
- Внутри папки должны быть файлы `manifest.json`, `popup.html`, `popup.js`, `background.js` и др.

2) Открыть страницу расширений браузера
- Chrome/Яндекс/Opera: в адресной строке откройте `chrome://extensions/`
- Edge: откройте `edge://extensions/`

3) Включить режим разработчика
- В правом верхнем углу страницы расширений включите «Режим разработчика» (Developer mode).

4) Загрузить распакованное расширение
- Нажмите «Загрузить распакованное» (Load unpacked).
- Укажите папку, куда вы распаковали архив (сама папка проекта, где лежит `manifest.json`).
- После выбора папки расширение появится в списке и станет доступно на панели браузера (значок с P$).

5) Разрешения (если появились запросы)
- Подтвердите запрошенные разрешения (чтение вкладки, скачивание файлов и т.д.).

6) Запуск
- Нажмите на значок расширения на панели браузера.
- В открывшемся окне выберите файл XLSX/CSV и следуйте подсказкам.

Обновление расширения
- Если вам прислали новый архив с исправлениями: удалите старую папку, распакуйте новый архив и на странице `chrome://extensions/` нажмите «Обновить» (или удалите и снова «Загрузить распакованное» на новую папку).

Удаление
- Откройте `chrome://extensions/` и нажмите «Удалить» рядом с расширением.
